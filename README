Fork from http://www.phoboslab.org/projects/asaph